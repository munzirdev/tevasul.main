# دليل إعداد بوت التلقرام للشات بوت

## نظرة عامة

تم ربط الشات بوت مع بوت تلقرام لإرسال إشعارات فورية للمشرفين عند:
- طلب العميل التحدث مع ممثل خدمة عملاء
- وصول رسائل جديدة
- وصول رسائل مستعجلة

## المميزات

### 🔔 إشعارات فورية
- إشعارات تلقرام فورية عند طلب الدعم
- رسائل تفاعلية مع أزرار للرد السريع
- إشعارات خاصة للرسائل المستعجلة

### 📱 واجهة تفاعلية
- أزرار للرد السريع على العملاء
- عرض تفاصيل العميل والجلسة
- إمكانية الاتصال المباشر بالعميل

### 🔒 أمان عالي
- حماية رموز البوت
- تشفير البيانات الحساسة
- صلاحيات محدودة للمستخدمين

## خطوات الإعداد

### 1. إنشاء بوت تلقرام

1. اذهب إلى [@BotFather](https://t.me/BotFather) في تلقرام
2. اكتب `/newbot` لإنشاء بوت جديد
3. اتبع التعليمات وأعطِ اسماً للبوت
4. احصل على رمز البوت (Bot Token)

### 2. الحصول على معرف المحادثة

1. ابدأ محادثة مع البوت الجديد الذي أنشأته
2. اذهب إلى [@userinfobot](https://t.me/userinfobot)
3. اكتب أي رسالة للحصول على معرف المحادثة الخاص بك

### 3. إعداد البوت في النظام

1. اذهب إلى لوحة التحكم
2. اختر "إعدادات التلقرام"
3. أدخل رمز البوت ومعرف المحادثة
4. فعّل البوت
5. اختبر الاتصال

## أنواع الإشعارات

### 🚨 طلب ممثل خدمة عملاء
```
🚨 طلب ممثل خدمة عملاء جديد

👤 معلومات العميل:
• الاسم: أحمد محمد
• البريد الإلكتروني: ahmed@example.com
• رقم الهاتف: +966501234567
• البلد: Saudi Arabia

💬 آخر رسالة:
أريد التحدث مع ممثل حقيقي

📊 تفاصيل الجلسة:
• معرف الجلسة: demo-session-001
• عدد الرسائل: 3
• الأولوية: 🚨 مستعجل
• اللغة: العربية

⏰ التوقيت:
2024-01-15 14:30:25
```

### 💬 رسالة جديدة
```
💬 رسالة جديدة من العميل

👤 العميل: أحمد محمد

💬 الرسالة:
مشكلة في التأمين الصحي

📊 تفاصيل الجلسة:
• معرف الجلسة: demo-session-002
• عدد الرسائل: 5

⏰ التوقيت:
2024-01-15 14:35:10
```

### 🚨 رسالة مستعجلة
```
🚨 رسالة مستعجلة!

👤 العميل: أحمد محمد

💬 الرسالة المستعجلة:
مشكلة عاجلة في التأمين الصحي

📊 تفاصيل الجلسة:
• معرف الجلسة: demo-session-003
• الأولوية: 🚨 مستعجل
• عدد الرسائل: 8

⏰ التوقيت:
2024-01-15 14:40:15

⚠️ هذه رسالة مستعجلة تتطلب رداً فورياً!
```

## الأزرار التفاعلية

### للرد على العميل
- **👨‍💼 الرد على العميل**: للرد المباشر على العميل
- **📋 عرض التفاصيل**: لعرض تفاصيل الجلسة الكاملة

### للرسائل الجديدة
- **💬 الرد السريع**: للرد السريع على العميل

### للرسائل المستعجلة
- **🚨 رد عاجل**: للرد العاجل على العميل
- **📞 الاتصال بالعميل**: للاتصال المباشر بالعميل

## إعدادات متقدمة

### تخصيص الرسائل
يمكن تخصيص نص الرسائل في ملف `telegramService.ts`:

```typescript
private formatSupportRequestMessage(sessionData: any): string {
  return `
🚨 <b>طلب ممثل خدمة عملاء جديد</b>
// ... تخصيص النص هنا
  `.trim();
}
```

### إضافة أنواع إشعارات جديدة
يمكن إضافة أنواع إشعارات جديدة في دالة `checkForSupportRequests`:

```typescript
const supportRequests = sessionsData.filter(session => 
  session.status === 'waiting_support' && 
  // إضافة شروط جديدة هنا
  session.last_message.toLowerCase().includes('كلمة_جديدة')
);
```

## استكشاف الأخطاء

### مشاكل شائعة

#### البوت لا يرسل رسائل
1. تأكد من تفعيل البوت في الإعدادات
2. تحقق من صحة رمز البوت
3. تأكد من أن البوت بدأ محادثة معك

#### رسائل الخطأ
- **"Bot token is invalid"**: رمز البوت غير صحيح
- **"Chat not found"**: معرف المحادثة غير صحيح
- **"Bot was blocked"**: البوت محظور، ألغِ الحظر

#### إشعارات لا تصل
1. تحقق من اتصال الإنترنت
2. تأكد من أن البوت مفعل
3. اختبر الاتصال من الإعدادات

### سجلات الأخطاء
يمكن مراجعة سجلات الأخطاء في وحدة تحكم المتصفح:

```javascript
// في وحدة تحكم المتصفح
console.log('Telegram service errors:', telegramService.getConfig());
```

## الأمان

### حماية رموز البوت
- لا تشارك رمز البوت مع أي شخص
- استخدم متغيرات البيئة في الإنتاج
- راجع الصلاحيات بانتظام

### تشفير البيانات
- جميع البيانات الحساسة مشفرة
- الاتصالات تتم عبر HTTPS
- رموز البوت محمية في قاعدة البيانات

## الدعم

للمساعدة في إعداد بوت التلقرام:
- راجع هذا الدليل
- تحقق من سجلات الأخطاء
- اتصل بفريق الدعم التقني

## التحديثات المستقبلية

### المميزات المخططة
- [ ] دعم الرسائل الصوتية
- [ ] إرسال ملفات مرفقة
- [ ] دعم المجموعات والقنوات
- [ ] إحصائيات مفصلة
- [ ] قوالب رسائل مخصصة
- [ ] جدولة الرسائل
- [ ] دعم لغات إضافية
