# ูุธุงู ุงูุชุฑุฌูุฉ ุงูููุชุจู - Makefile
# Translation Office System - Makefile

.PHONY: help install run test clean build dist

# ุงููุชุบูุฑุงุช
PYTHON = python3
PIP = pip3
VENV = venv
PACKAGE_NAME = translation-office-system

# ุงููุณุงุนุฏุฉ
help:
	@echo "ูุธุงู ุงูุชุฑุฌูุฉ ุงูููุชุจู - ุฃูุงูุฑ ูุชุงุญุฉ:"
	@echo "  install    - ุชุซุจูุช ุงูุชุทุจูู ูุงูุชุจุนูุงุช"
	@echo "  run        - ุชุดุบูู ุงูุชุทุจูู"
	@echo "  test       - ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช"
	@echo "  clean      - ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ"
	@echo "  build      - ุจูุงุก ุงูุชุทุจูู"
	@echo "  dist       - ุฅูุดุงุก ุญุฒูุฉ ุงูุชูุฒูุน"
	@echo "  standalone - ุชุดุบูู ุงููุงุฌูุฉ ุงููุณุชููุฉ"
	@echo "  server     - ุชุดุบูู ุฎุงุฏู ุงูุชุญูู ููุท"
	@echo "  gui        - ุชุดุบูู ุงููุงุฌูุฉ ุงูุฑุณูููุฉ ููุท"

# ุงูุชุซุจูุช
install:
	@echo "๐ฆ ุชุซุจูุช ุงูุชุทุจูู..."
	$(PYTHON) -m venv $(VENV)
	$(VENV)/bin/pip install --upgrade pip
	$(VENV)/bin/pip install -r requirements.txt
	$(VENV)/bin/pip install -e .
	@echo "โ ุชู ุงูุชุซุจูุช ุจูุฌุงุญ"

# ุชุดุบูู ุงูุชุทุจูู
run:
	@echo "๐ ุชุดุบูู ุงูุชุทุจูู..."
	$(VENV)/bin/python run.py

# ุชุดุบูู ุงููุงุฌูุฉ ุงููุณุชููุฉ
standalone:
	@echo "๐ ุชุดุบูู ุงููุงุฌูุฉ ุงููุณุชููุฉ..."
	$(VENV)/bin/python run_standalone_quick.py

# ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
test:
	@echo "๐งช ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช..."
	$(VENV)/bin/pytest tests/ -v

# ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ
clean:
	@echo "๐งน ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ..."
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	find . -type d -name "*.egg-info" -exec rm -rf {} +
	rm -rf build/
	rm -rf dist/
	rm -rf .pytest_cache/
	rm -rf .coverage
	rm -rf htmlcov/
	@echo "โ ุชู ุงูุชูุธูู"

# ุจูุงุก ุงูุชุทุจูู
build:
	@echo "๐จ ุจูุงุก ุงูุชุทุจูู..."
	$(VENV)/bin/python setup.py build

# ุฅูุดุงุก ุญุฒูุฉ ุงูุชูุฒูุน
dist: clean
	@echo "๐ฆ ุฅูุดุงุก ุญุฒูุฉ ุงูุชูุฒูุน..."
	$(VENV)/bin/python setup.py sdist bdist_wheel

# ุชุดุบูู ุฎุงุฏู ุงูุชุญูู ููุท
server:
	@echo "๐ ุชุดุบูู ุฎุงุฏู ุงูุชุญูู..."
	$(VENV)/bin/python verification_server.py

# ุชุดุบูู ุงููุงุฌูุฉ ุงูุฑุณูููุฉ ููุท
gui:
	@echo "๐ฅ๏ธ ุชุดุบูู ุงููุงุฌูุฉ ุงูุฑุณูููุฉ..."
	$(VENV)/bin/python main_window.py

# ุชุซุจูุช ุงูุชุทุจูู ูู ูุถุน ุงูุชุทููุฑ
dev-install:
	@echo "๐ง ุชุซุจูุช ุงูุชุทุจูู ูู ูุถุน ุงูุชุทููุฑ..."
	$(PYTHON) -m venv $(VENV)
	$(VENV)/bin/pip install --upgrade pip
	$(VENV)/bin/pip install -r requirements.txt
	$(VENV)/bin/pip install -e .[dev]
	@echo "โ ุชู ุงูุชุซุจูุช ูู ูุถุน ุงูุชุทููุฑ"

# ูุญุต ุงูููุฏ
lint:
	@echo "๐ ูุญุต ุงูููุฏ..."
	$(VENV)/bin/flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
	$(VENV)/bin/flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics

# ุชูุณูู ุงูููุฏ
format:
	@echo "๐จ ุชูุณูู ุงูููุฏ..."
	$(VENV)/bin/black .

# ูุญุต ุงูุฃููุงุน
type-check:
	@echo "๐ ูุญุต ุงูุฃููุงุน..."
	$(VENV)/bin/mypy .

# ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
init-db:
	@echo "๐๏ธ ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช..."
	$(VENV)/bin/python -c "from models import TranslationManager; tm = TranslationManager(); print('ุชู ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช')"

# ูุณุฎ ุงุญุชูุงุทู
backup:
	@echo "๐พ ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ..."
	tar -czf backup-$(shell date +%Y%m%d-%H%M%S).tar.gz --exclude=venv --exclude=__pycache__ --exclude=*.pyc .

# ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
restore:
	@echo "๐ฅ ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ..."
	@read -p "ุฃุฏุฎู ุงุณู ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ: " backup_file; \
	tar -xzf $$backup_file

# ุชุญุฏูุซ ุงูุชุทุจูู
update:
	@echo "๐ ุชุญุฏูุซ ุงูุชุทุจูู..."
	git pull origin main
	$(VENV)/bin/pip install -r requirements.txt --upgrade
	$(VENV)/bin/pip install -e . --upgrade
	@echo "โ ุชู ุงูุชุญุฏูุซ"

# ูุนูููุงุช ุงููุธุงู
info:
	@echo "๐ ูุนูููุงุช ุงููุธุงู:"
	@echo "Python: $(shell $(PYTHON) --version)"
	@echo "Pip: $(shell $(PIP) --version)"
	@echo "OS: $(shell uname -s)"
	@echo "Architecture: $(shell uname -m)"
